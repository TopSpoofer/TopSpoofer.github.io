---
layout: post
title:  "树形结构的数据库设计与总结"
date:   '2017-07-13 12:00:00'
author: 'spoofer'
categories: 'blog'
tags: '数据库'
excerpt: '数据库 mysql 树形表'
keywords: '数据库 mysql 树形表'
---

## 概述
现在基于关系的数据库都是以2维表的形式记录存储数据的，所以不能将树结构直接存入DBMS。本文主要介绍各种流行树形表的设计。

当前流行的树形数据库设计主要有以下几种：

```
1、Adjacency List
2、Path Enumeration
3、Nested Sets
4、Closure Table
```

### 1、Adjacency List

Adjacency List 在设计时会记录每个节点的父节点，这样可以非常简单就可以找到直接父级和所有直接子级。
但是缺点也是非常明显的， 需要找到所有子孙时非常麻烦。

 Adjacency List 的表设计如下：

| id        | parent_id           | name |
| ------------- |:-------------:| :---------|
| 1      | 0 | boss |
| 2      | 1 | C# leader |
| 3      | 1 | Java leader |
| 4      | 2 | C# programmer |
| 5      | 3 | java programmer |

Adjacency List 设计和实现非常方便、直观，但缺点也非常突出，进行curd时操作是低效的，因为需要‘递归’操作，产生过多的io。
在树规模大的时候这个开销是无法接受的。但是如果在树规模比较小的时候可以将借助缓存进行优化，避免过多的磁盘io。

### 2、Path Enumeration

Path Enumeration 方案需要加入 path字段去记录当前路径。

| id        | path          | name |
| ------------- |:-------------| :---------|
| 1      | /1 | boss |
| 2      | /1/2 | C# leader |
| 3      | /1/3 | Java leader |
| 4      | /1/2/4 | C# programmer |
| 5      | /1/3/5 | java programmer |

这个做法的优点是，层级非常直观，缺点是层级非常多的时候path会非常长，无法维护，而且path需要程序自己来维护，无法在数据库层面保护数据的有效性。


### 3、Nested Sets

Nested Sets需要left和right来维护树结构，采用树的前序遍历来编排left和right。


| id        | left  | right | name |
| ------------- |:-------------| :---------|:--------|
| 1      | 1 | 10 | boss |
| 2      | 2 | 5 | C# leader |
| 3      | 6 | 9 | Java leader |
| 4      | 3 | 4 | C# programmer |
| 5      | 7 | 8 | java programmer |


![NestedSets.png][1]




































[1]: http://www.spoofer.top/assets/images/2017/07/树形.png
